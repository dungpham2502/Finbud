{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, withCtx as _withCtx, createElementVNode as _createElementVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"home-container\"\n};\nconst _hoisted_2 = {\n  class: \"chat-container\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_ChatHeader = _resolveComponent(\"ChatHeader\");\n  const _component_MessageComponent = _resolveComponent(\"MessageComponent\");\n  const _component_ChatFrame = _resolveComponent(\"ChatFrame\");\n  const _component_UserInput = _resolveComponent(\"UserInput\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_ChatHeader, {\n    threadId: $data.currentThread\n  }, null, 8 /* PROPS */, [\"threadId\"]), _createVNode(_component_ChatFrame, null, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.messages, (message, index) => {\n      return _openBlock(), _createBlock(_component_MessageComponent, {\n        key: index,\n        \"is-user\": message.isUser,\n        text: message.text,\n        typing: message.typing,\n        timestamp: message.timestamp,\n        username: message.isUser ? 'Tri Bui' : 'FinBud Bot',\n        \"avatar-src\": message.isUser ? $data.userAvatar : $data.botAvatar\n      }, null, 8 /* PROPS */, [\"is-user\", \"text\", \"typing\", \"timestamp\", \"username\", \"avatar-src\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_UserInput, {\n    onSendMessage: $options.sendMessage,\n    onClearMessage: $options.clearMessage\n  }, null, 8 /* PROPS */, [\"onSendMessage\", \"onClearMessage\"])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_ChatHeader","threadId","$data","currentThread","_component_ChatFrame","default","_withCtx","_Fragment","_renderList","messages","message","index","_createBlock","_component_MessageComponent","key","isUser","text","typing","timestamp","username","userAvatar","botAvatar","_","_component_UserInput","onSendMessage","$options","sendMessage","onClearMessage","clearMessage"],"sources":["/Users/buidinhtri/Desktop/FindBud/FinBud-AI-bot/src/views/ChatView.vue"],"sourcesContent":["<template>\n  <div class=\"home-container\">\n    <div class=\"chat-container\">\n      <ChatHeader :threadId=\"currentThread\" />\n      <ChatFrame>\n        <MessageComponent v-for=\"(message, index) in messages\" :key=\"index\" :is-user=\"message.isUser\"\n          :text=\"message.text\" :typing=\"message.typing\" :timestamp=\"message.timestamp\"\n          :username=\"message.isUser ? 'Tri Bui' : 'FinBud Bot'\" :avatar-src=\"message.isUser ? userAvatar : botAvatar\" />\n      </ChatFrame>\n\n\n\n      <UserInput @send-message=\"sendMessage\" @clear-message=\"clearMessage\" />\n    </div>\n\n\n  </div>\n</template>\n\n<script>\nimport ChatHeader from '../components/ChatHeader.vue';\nimport ChatFrame from '../components/ChatFrame.vue'\nimport MessageComponent from '../components/MessageComponent.vue';\nimport UserInput from '../components/UserInput.vue';\nimport { fetchStockPrice } from '@/services/stockServices';\nimport { gptAPICall } from '@/services/gptServices';\n\n\nexport default {\n  name: 'ChatView',\n  props: ['threadId'],\n  components: {\n    ChatHeader,\n    ChatFrame,\n    MessageComponent,\n    UserInput,\n  },\n  data() {\n    return {\n      newMessage: '',\n      messages: [],\n      userAvatar: require('@/assets/tri.jpeg'),\n      botAvatar: require('@/assets/bot.png'),\n      currentThread: {}, // The current selected thread\n    };\n  },\n\n  watch: {\n    threadId: {\n      immediate: true,\n      handler(newThreadId) {\n        console.log('Received new thread ID:', newThreadId);\n        if (newThreadId != null) {\n          console.log(\"Hello\");\n          this.updateCurrentThread(newThreadId);\n        }\n      }\n    },\n  },\n  computed: {\n    currentChatWindow() {\n      // Dynamic component name based on the selected thread or default chat window\n      return this.currentThread.id ? 'ChatWindow' : 'DefaultChatWindow';\n    },\n  },\n  methods: {\n    clearMessage() {\n      this.newMessage = ''\n    },\n    // sendMessage(newMessage) {\n    //   console.log(\"start sending this.newMessage: \", newMessage)\n    //   this.messages.push({\n    //     text: newMessage.trim(),\n    //     isUser: true,\n    //     typing: true,\n    //     timestamp: new Date().toLocaleTimeString()\n    //   });\n    //   // Simulate a delay for typing effect, then set typing to false\n    //   console.log(\"Updated messages array: \", this.messages);\n\n    //   this.newMessage = '';\n    // },\n\n    updateCurrentThread(newThreadId) {\n      console.log(\"Update current thread function triggered: \", newThreadId)\n      // const thread = this.threads.find(thread => thread.id.toString() === newThreadId);\n      const thread = newThreadId.toString();\n      console.log(thread)\n      if (thread) {\n        this.currentThread = thread;\n        // this.messages = thread.messages || [];\n      } else {\n        console.error('Thread with ID', newThreadId, 'not found');\n        this.currentThread = {};\n        this.messages = [];\n      }\n      console.log(\"Current thread: \", this.currentThread)\n    },\n    async sendMessage(newMessage) {\n      // if (!this.newMessage.trim()) return;\n\n      console.log(\"start sending message in send message..\")\n\n      this.messages.push({\n        text: newMessage.trim(),\n        isUser: true,\n        typing: true,\n        timestamp: new Date().toLocaleTimeString()\n      });\n      // Simulate a delay for typing effect, then set typing to false\n\n      this.newMessage = '';\n\n      const stockCode = this.extractStockCode(this.messages[this.messages.length - 1].text);\n      if (stockCode != '') {\n        try {\n          const price = await fetchStockPrice(stockCode);\n          const timeStamp = new Date().toLocaleTimeString();\n          console.log(\"This is time stamp when ask about stock price: \", timeStamp)\n          let responseText = `Giá cổ phiếu ${stockCode} hiện giờ là $${price}, tính theo mốc thời gian ${timeStamp} `;\n          // if (shares !== null) {\n          //   // If both stock code and shares are provided, calculate total value\n          //   const totalValue = (Number(price) * shares).toFixed(2);\n          //   responseText = `Bạn có ${shares} cổ phiếu ${stockCode}, với tổng trị giá là $${totalValue}.`;\n          //   this.messages.push({ text: `Bạn có ${shares} cổ phiếu ${stockCode}, với tổng trị giá là $${totalValue}.`, isUser: false, });\n          // }\n          this.addTypingResponse(responseText, false);\n          // Send a fixed message to the GPT API asking for analysis about the company\n          const analysisQuestion = `Phân tích các số liệu sau từ công ty Tesla Chỉ Số Nâng CaoTên\tCông ty\tNgành\n      Tỉ số P/E TTM\t39.31\t18.18\n  Giá trên doanh thu TTM\t5.66\t3.93\n  Giá và dòng tiền mặt MRQ\t64.94\t16.68\n  Giá và dòng tiền mặt tự do TTM\t388.36\t33.6\n  Giá trên giá ghi sổ sách MRQ\t8.34\t2.67\n  Giá trên sổ sách hữu hình MRQ\t8.39\t0.64\n        \n  Khả năng sinh lợi: TTM đối với Biên Lợi Trung Bình 5 Năm TTM (%)  TB 5 năm (%)\n  Lãi gộp\n  Lãi gộp kinh doanh\n  Tỷ lệ lời trước thuế\n  Hệ số biên lợi nhuận ròng\n  0%\n  5%\n  10%\n  15%\n  20%\n  25%\n  Hệ số biên lợi nhuận ròng\n       TTM (%)\t14.37%\n       TB 5 năm (%)\t7.59%\n   \n  Lãi gộp TTM\t17.78%\t17.76\n  Lãi Gộp 5YA\t21.49%\t14.78\n  Lãi gộp kinh doanh TTM\t7.81%\t-8.16\n  Lãi gộp kinh doanh 5YA\t8.96%\t-2,221.2\n  Tỷ lệ lời trước thuế TTM\t9.21%\t-11.27\n  Tỷ lệ lời trước thuế 5YA\t7.96%\t-2,230.78\n  Hệ số biên lợi nhuận ròng TTM\t14.37%\t-11.97\n  Hệ số biên lợi nhuận ròng 5YA\t7.59%\t-2,209.64\n        \n  Doanh thu/Cổ phần TTM\t29.75\t11,209.08\n  EPS cơ bản ANN\t4.73\t637.24\n  EPS pha loãng ANN\t4.3\t637.15\n  Giá trị sổ sách/Cổ phần MRQ\t20.21\t6,320.76\n  Giá trị sổ sách hữu hình/Cổ phần MRQ\t20.06\t6,055.95\n  Tiền mặt/Cổ phần MRQ\t3.71\t1,383.5\n  Dòng tiền/Cổ phần TTM\t3.45\t-72.97\n       `;\n          const gptResponse = await gptAPICall(analysisQuestion);\n          const gptText = gptResponse.choices[0].message.content;\n\n          this.addTypingResponse(gptText, false);\n\n        } catch (error) {\n          console.error('Error:', error);\n          this.messages.push({ text: `Error fetching data for ${stockCode}.`, isUser: false, timestamp: new Date().toLocaleTimeString() });\n        }\n      }\n      else {\n        setTimeout(\n          () => {\n            this.addTypingResponse('Tôi là FinBud, trợ lý AI trong lĩnh vực tài chính của bạn, phát triển bởi Bui Dinh Tri. Tôi được cấu hình đặc biệt trên nền tảng GPT-3.5 Turbo, với mục tiêu cung cấp thông tin sâu hơn và chuyên môn về tài chính và thị trường cổ phiếu.', false);\n          }, 300\n        )\n      }\n\n\n\n\n\n    },\n\n    addTypingResponse(text, isUser) {\n      // Add a typing message first\n      const typingMessage = {\n        text: text,\n        isUser: isUser,\n        typing: true,\n        timestamp: new Date().toLocaleTimeString(),\n        username: isUser ? 'You' : 'FinBud Bot'\n      };\n\n      this.messages.push(typingMessage);\n      setTimeout(() => {\n        typingMessage.text = text;\n        typingMessage.typing = false;\n        this.$forceUpdate(); // Force update to show changes\n      }, 2000); // simulate typing delay\n    },\n\n    extractStockCode(message) {\n      const pattern = /\\b[A-Z]{3,5}\\b/g;\n      const matches = message.match(pattern) || [];\n      console.log(\"Ham extract: \", matches)\n      return matches;\n    },\n\n    extractSharesAndCode(message) {\n      // Regex to find stock codes: assumes codes are upper-case letters optionally followed by numbers\n      const stockCodePattern = /\\b[A-Z]{1,5}\\b/g;\n      // Regex to find numbers: looks for numbers that may have commas and come after the word 'shares'\n      const sharesPattern = /(\\b\\d{1,3}(,\\d{3})*\\b)(?=\\s*shares)/gi;\n\n      const stockCodes = message.match(stockCodePattern);\n      const sharesMatches = message.match(sharesPattern);\n\n      let shares;\n      if (sharesMatches && sharesMatches.length > 0) {\n        // Remove commas and convert to integer\n        shares = parseInt(sharesMatches[0].replace(/,/g, ''), 10);\n      }\n\n      // We return the first stock code found and the number of shares, if any\n      return {\n        stockCode: stockCodes ? stockCodes[0] : null, // Just taking the first match for simplicity\n        shares: shares || null\n      };\n    },\n\n    async calculateTotalValue(stockCode, shares) {\n      if (!stockCode || !shares) {\n        throw new Error(\"Stock code or number of shares missing.\");\n      }\n      try {\n        const price = await fetchStockPrice(stockCode);\n        // Convert price to a number and calculate total value\n        const totalValue = (Number(price) * shares).toFixed(2);\n        return totalValue;\n      } catch (error) {\n        console.error('Error calculating total value:', error);\n        throw error; // Re-throw the error to handle it in the calling function\n      }\n    },\n\n    async fakeResponse(message) {\n      // Simulate fake response from the backend API\n      return \"This is a fake response to the message: \" + message;\n    },\n\n\n    mounted() {\n      // Update the current time every second\n      setInterval(() => {\n        this.currentTime = new Date().toLocaleTimeString();\n      }, 500);\n    }\n  }\n}\n</script>\n\n<style>\n.home-container {\n  width: 100%;\n  /* Ensures the container fills the viewport width */\n  box-sizing: border-box;\n  /* Includes padding and border in the element's total width */\n}\n\n.chat-container {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n</style>"],"mappings":";;EACOA,KAAK,EAAC;AAAgB;;EACpBA,KAAK,EAAC;AAAgB;;;;;;uBAD7BC,mBAAA,CAeM,OAfNC,UAeM,GAdJC,mBAAA,CAWM,OAXNC,UAWM,GAVJC,YAAA,CAAwCC,qBAAA;IAA3BC,QAAQ,EAAEC,KAAA,CAAAC;EAAa,uCACpCJ,YAAA,CAIYK,oBAAA;IARlBC,OAAA,EAAAC,QAAA,CAK0B,MAAoC,E,kBAAtDX,mBAAA,CAEgHY,SAAA,QAPxHC,WAAA,CAKqDN,KAAA,CAAAO,QAAQ,EAL7D,CAKkCC,OAAO,EAAEC,KAAK;2BAAxCC,YAAA,CAEgHC,2BAAA;QAFxDC,GAAG,EAAEH,KAAK;QAAG,SAAO,EAAED,OAAO,CAACK,MAAM;QACzFC,IAAI,EAAEN,OAAO,CAACM,IAAI;QAAGC,MAAM,EAAEP,OAAO,CAACO,MAAM;QAAGC,SAAS,EAAER,OAAO,CAACQ,SAAS;QAC1EC,QAAQ,EAAET,OAAO,CAACK,MAAM;QAA8B,YAAU,EAAEL,OAAO,CAACK,MAAM,GAAGb,KAAA,CAAAkB,UAAU,GAAGlB,KAAA,CAAAmB;;;IAP3GC,CAAA;MAYMvB,YAAA,CAAuEwB,oBAAA;IAA3DC,aAAY,EAAEC,QAAA,CAAAC,WAAW;IAAGC,cAAa,EAAEF,QAAA,CAAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}